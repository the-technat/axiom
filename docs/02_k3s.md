# 02 - K3s

## Prerequisites

- Get [k3sup](https://github.com/alexellis/k3sup) to all of your nodes.
- Generate a pre-approved tailscale machine key that is already tagged for k3s (each machine needs his own key)
- Generate a pair of s3 access-keys for the backup bucket (see https://docs.infomaniak.cloud/documentation/04.object-storage/010.s3/) -> save the key in our vault

## Installation

Once k3sup is installed on your nodes, get a shell somehow and start bootstraping the first server node:


```
k3sup install --cluster --local --k3s-extra-args \
  '--cluster-cidr 10.127.0.0/16 
   --service-cidr 10.227.0.0/16  \
   --vpn-auth=name=tailscale,joinKey=tskey-auth-xxxxxx-YYYYYYYYYY \
   --etcd-s3 \
   --etcd-s3-endpoint	https://s3.pub1.infomaniak.cloud/
   --etcd-s3-access-key= \
   --etcd-s3-secret-key=	\
   --etcd-s3-bucket=axiom-k3s-backup	\ 
   --etcd-s3-folder=k3s \
   '
```

